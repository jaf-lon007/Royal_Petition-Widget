<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petition - Royal's Should Respect Residents</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/4.1.7/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/emailjs/2.6.4/email.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .petition-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .petition-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .petition-title {
            font-size: 32px;
            font-weight: 700;
            margin: 0 0 15px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .petition-subtitle {
            font-size: 18px;
            font-style: italic;
            opacity: 0.95;
            margin: 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .petition-content {
            padding: 40px 30px;
        }

        .petition-form {
            display: grid;
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 16px;
        }

        .required {
            color: #e74c3c;
        }

        .form-input, .form-select, .form-textarea {
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .signature-section {
            background: #f8f9fb;
            border-radius: 12px;
            padding: 25px;
            border: 2px dashed #d1d9e6;
        }

        .signature-container {
            position: relative;
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .signature-canvas {
            width: 100%;
            height: 200px;
            display: block;
            cursor: crosshair;
        }

        .signature-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #94a3b8;
            font-size: 18px;
            pointer-events: none;
            transition: opacity 0.3s ease;
            text-align: center;
        }

        .signature-placeholder.hidden {
            opacity: 0;
        }

        .signature-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .signature-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #64748b;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ef4444;
            transition: background-color 0.3s ease;
        }

        .status-dot.signed {
            background: #22c55e;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            padding: 16px 32px;
            width: 100%;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            text-align: center;
        }

        .success-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .petition-header {
                padding: 30px 20px;
            }
            
            .petition-title {
                font-size: 26px;
            }
            
            .petition-subtitle {
                font-size: 16px;
            }
            
            .petition-content {
                padding: 30px 20px;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .date-field {
            background: #f8f9fb;
            color: #64748b;
        }

        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box p {
            margin: 0;
            color: #1e40af;
            font-size: 14px;
        }

        .data-protection-notice {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
        }

        .data-protection-notice h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
        }

        .data-protection-notice p {
            margin: 0;
            font-size: 14px;
            color: #6c757d;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="petition-container">
        <div class="petition-header">
            <h1 class="petition-title">Petition - Royal's Should Respect Residents</h1>
            <p class="petition-subtitle">
                This petition is supported by residents from Hermitage Court and other nearby properties in Wapping who are affected by the ongoing disruption, fumes, noise and safety concerns caused by Royal Dry Cleaners' operations.
            </p>
        </div>

        <div class="petition-content">
            <div class="info-box">
                <p><strong>📧 How it works:</strong> When you sign this petition, your signature and details will be automatically emailed to the petition organizer for compilation and submission to the relevant authorities.</p>
            </div>

            <form class="petition-form" id="petitionForm">
                <div class="form-group">
                    <label class="form-label" for="fullName">Name <span class="required">*</span></label>
                    <input type="text" id="fullName" name="fullName" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="residentType">Resident Type <span class="required">*</span></label>
                    <select id="residentType" name="residentType" class="form-select" required>
                        <option value="">Please select...</option>
                        <option value="hermitage-resident-freeholder">Hermitage Court - Resident (Share-of-Freeholder)</option>
                        <option value="hermitage-nonresident-freeholder">Hermitage Court - Non-Resident (Share-of-Freeholder)</option>
                        <option value="hermitage-tenant">Hermitage Court - Tenant</option>
                        <option value="hermitage-other">Hermitage Court - Other Resident</option>
                        <option value="hermitage-commercial">Hermitage Court - Commercial Leaseholder</option>
                        <option value="local-resident">Local Resident (Neighbour)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="address">Address <span class="required">*</span></label>
                    <textarea id="address" name="address" class="form-textarea" rows="3" required placeholder="Please enter your full address"></textarea>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label" for="email">Email Address <span class="required">*</span></label>
                        <input type="email" id="email" name="email" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="householdSize">Number of People in Household (if applicable)</label>
                        <select id="householdSize" name="householdSize" class="form-select">
                            <option value="">Please select...</option>
                            <option value="Not Applicable">Not Applicable</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5+">5+</option>
                        </select>
                    </div>
                </div>

                <div class="signature-section">
                    <label class="form-label">Digital Signature <span class="required">*</span></label>
                    <p style="margin: 5px 0 15px 0; color: #64748b; font-size: 14px;">
                        Please sign below using your mouse, finger, or stylus
                    </p>
                    
                    <div class="signature-container">
                        <canvas class="signature-canvas" id="signatureCanvas"></canvas>
                        <div class="signature-placeholder" id="signaturePlaceholder">
                            ✍️ Click here to start signing
                        </div>
                    </div>

                    <div class="signature-controls">
                        <div class="signature-status">
                            <div class="status-dot" id="statusDot"></div>
                            <span id="statusText">Not signed</span>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="clearSignature()">
                            Clear Signature
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="dateSign">Date Signed</label>
                    <input type="text" id="dateSign" name="dateSign" class="form-input date-field" readonly>
                </div>

                <div class="form-group">
                    <label class="form-label" for="comments">Any Comments or Specific Concerns?</label>
                    <textarea id="comments" name="comments" class="form-textarea" rows="4" placeholder="Please share any specific concerns or comments about the issues with Royal Dry Cleaners..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary" id="submitBtn">
                    Sign Petition
                </button>

                <div class="data-protection-notice">
                    <h3>Data Protection Note</h3>
                    <p>All personal information collected for this petition will be used solely to present these concerns to the above-listed parties. Your details will not be shared with third parties or used for any other purpose. You may request the removal of your information at any time.</p>
                </div>
            </form>

            <div class="success-message" id="successMessage">
                <div class="success-title">Thank You for Signing!</div>
                <p>Your petition signature has been successfully submitted and emailed to the organizer.</p>
            </div>
        </div>
    </div>

    <script>
        let signaturePad;
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeSignature();
            initializeForm();
            setTodaysDate();
        });

        function initializeSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const placeholder = document.getElementById('signaturePlaceholder');
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');

            // Initialize signature pad
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgba(255, 255, 255, 0)',
                penColor: 'rgb(0, 0, 0)',
                velocityFilterWeight: 0.7,
                minWidth: 0.5,
                maxWidth: 2.5,
                throttle: 16,
                minPointDistance: 3,
            });

            // Resize canvas
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * ratio;
                canvas.height = rect.height * ratio;
                canvas.getContext('2d').scale(ratio, ratio);
                signaturePad.clear();
                updateSignatureStatus();
            }

            // Update signature status
            function updateSignatureStatus() {
                const isEmpty = signaturePad.isEmpty();
                
                if (isEmpty) {
                    statusDot.classList.remove('signed');
                    statusText.textContent = 'Not signed';
                    placeholder.classList.remove('hidden');
                } else {
                    statusDot.classList.add('signed');
                    statusText.textContent = 'Signature ready';
                    placeholder.classList.add('hidden');
                }
            }

            // Event listeners
            signaturePad.addEventListener('beginStroke', updateSignatureStatus);
            signaturePad.addEventListener('endStroke', updateSignatureStatus);
            window.addEventListener('resize', resizeCanvas);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });
            canvas.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
            canvas.addEventListener('touchend', (e) => e.preventDefault(), { passive: false });

            resizeCanvas();
        }

        function clearSignature() {
            signaturePad.clear();
            document.getElementById('statusDot').classList.remove('signed');
            document.getElementById('statusText').textContent = 'Not signed';
            document.getElementById('signaturePlaceholder').classList.remove('hidden');
        }

        function setTodaysDate() {
            document.getElementById('dateSign').value = new Date().toLocaleDateString('en-GB');
        }

        function initializeForm() {
            const form = document.getElementById('petitionForm');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validate signature
                if (signaturePad.isEmpty()) {
                    alert('Please provide your signature before submitting the petition.');
                    return;
                }

                // Get form data
                const formData = {
                    fullName: document.getElementById('fullName').value,
                    residentType: document.getElementById('residentType').value,
                    address: document.getElementById('address').value,
                    email: document.getElementById('email').value,
                    householdSize: document.getElementById('householdSize').value || 'Please select...',
                    signature: signaturePad.toDataURL(),
                    dateSign: document.getElementById('dateSign').value,
                    comments: document.getElementById('comments').value,
                    timestamp: new Date().toISOString()
                };

                submitPetition(formData);
            });
        }

        function submitPetition(formData) {
            const submitBtn = document.getElementById('submitBtn');
            const successMessage = document.getElementById('successMessage');
            
            // Update button state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            // Generate unique ID
            const petitionId = 'PET-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
            
            // Prepare data for Google Apps Script
            const petitionData = {
                petitionId: petitionId,
                fullName: formData.fullName,
                residentType: formData.residentType,
                address: formData.address,
                email: formData.email,
                householdSize: formData.householdSize,
                signature: formData.signature,
                dateSign: formData.dateSign,
                comments: formData.comments || '',
                timestamp: new Date().toLocaleString('en-GB')
            };

            // Submit to Google Apps Script
            // REPLACE 'YOUR_GOOGLE_APPS_SCRIPT_URL' with your actual deployed script URL
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbxqA7DzVQ72-37iK4-cbwJNWhVRfpTFtj6ODgR3bPKYUs819OrINot_x0__dv_tNaO0/exec';
            
            console.log('Submitting to:', scriptUrl);
            console.log('Petition data:', petitionData);
            
            fetch(scriptUrl, {
                method: 'POST',
                mode: 'no-cors',  // This bypasses CORS issues
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(petitionData)
            })
            .then(response => {
                // With no-cors mode, we can't read the response, so assume success
                console.log('Request sent successfully');
                
                // Show success message
                successMessage.innerHTML = `
                    <div class="success-title">Thank You for Signing!</div>
                    <p>Your petition signature has been submitted and emailed to the organizer.</p>
                    <p><strong>Petition ID:</strong> ${petitionId}</p>
                `;
                successMessage.style.display = 'block';
                successMessage.scrollIntoView({ behavior: 'smooth' });
                
                // Reset form
                document.getElementById('petitionForm').reset();
                clearSignature();
                setTodaysDate();
                
                console.log('Petition signed successfully with ID:', petitionId);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error submitting your petition. Please try again or contact support.');
            })
            .finally(() => {
                // Reset button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Sign Petition';
            });
        }
    </script>
</body>
</html>
